---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

import Layout from "@/layouts/Layout.astro";
import SocialLinks from "@/components/SocialLinks.astro";
import PostCard from "@/components/PostCard.astro";
import ProjectCard from "@/components/PopularPost.astro";
import Link from "@/components/shared/Link.astro";
import convertAsteriskToStrongTag from "@/utils/convertAsteriskToStrongTag";

import presentation from "@/data/presentation";
import projects from "@/data/projects";
import KPICard from "@/components/KPICard.astro";
import LikeButton from "@/components/LikeButton.astro";

const posts = (await getCollection("posts")).sort(function (first, second) {
	return second.data.publishedAt.getTime() - first.data.publishedAt.getTime();
});


const popularPosts = posts.filter((post) => post.data.isPopular === true);
---

<Layout>
	<main class="flex flex-col gap-20">
		<article
			class="flex flex-col gap-8 md:flex-row-reverse md:justify-end md:gap-12"
		>
			{
				presentation.profile && (
					<Image
						src={presentation.profile}
						class="w-1/4 self-center rounded-full"
						alt="Your Profile"
						width="200"
						height="200"
					/>
				)
			}

			<div class="flex flex-col gap-8">
				<h1 class="text-3xl text-neutral-100">
					{presentation.title}
				</h1>

				<!-- 
        original
        <h2
          class="w-auto  leading-6"
          set:html={convertAsteriskToStrongTag(presentation.description)}
        >        
-->

				<h2 class="w-auto leading-6">
					Cuando estaba investigando en internet sobre lo que ser√≠a estudiar
					Ciencias Computacionales (la carrera del futuro) en la mejor
					universidad privada de M√©xico, antes de tomar la decisi√≥n m√°s
					importante de mi vida me hubiera gustado poder escuchar o leer sobre
					lo que realmente es la carrera con testimonios de sus estudiantes.
					Todo con el objetivo de saber si realmente este es mi camino a seguir
					profesionalmente (ya graduado puedo decir que s√≠ lo fue).
					<br />
					<br />
					Esta p√°gina contiene relatos de estudiantes egresados de la carrera de
					Ing. en Tecnolog√≠as Computacionales y afines. El objetivo es que TU, la
					persona visitando esta p√°gina, llegues a tus propias conclusiones sobre
					lo que es estudiar una carrera en software (o relacionada a la <a
						class="underline underline-offset-2"
						href="https://www.investopedia.com/terms/t/technology_sector.asp"
						>"tech industry"</a
					>) aqu√≠ en M√©xico y conozcas la historia de personas que ya han
					recorrido un camino que tu est√°s por recorrer.
				</h2>

				<SocialLinks />
			</div>
		</article>

		<article class="flex flex-col gap-8">
			<header>
				<h3 class="text-lg text-neutral-100">M√©tricas</h3>
			</header>
			<section class="flex flex-col gap-4 md:flex-row md:flex-wrap">
				<KPICard title="Posts subidos" metric={2} description="This is awesome">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						class="w-4 h-4"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
						stroke-linecap="round"
						stroke-linejoin="round"
						class="lucide lucide-sticky-note"
						><path
							d="M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z"
						></path><path d="M15 3v4a2 2 0 0 0 2 2h4"></path></svg
					>
				</KPICard>
				<KPICard
					title="Likes totales"
					metric={"TBD"}
					description="This is awesome"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						class="w-4 h-4"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
						stroke-linecap="round"
						stroke-linejoin="round"
						class="lucide lucide-heart"
						><path
							d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"
						></path></svg
					>
				</KPICard>
			</section>
		</article>

		<article class="flex flex-col gap-8">
			<header class="flex w-full flex-row justify-between gap-2">
				<h3 class="text-lg text-neutral-100">Posts recientes</h3>
				<Link href="/posts" label="Ver todos" isUnderline target="_self" />
			</header>
			{posts.length === 0 && <p>Soon, stay connected üëÄ...</p>}

			<section class="flex flex-col gap-4 md:flex-row md:flex-wrap">
				{
					posts.length !== 0 &&
						posts
							.slice(0, 2)
							.map((post) => (
								<PostCard
									publishedAt={post.data.publishedAt}
									title={post.data.title}
									description={post.data.description}
									slug={post.slug}
								/>
							))
				}
			</section>
		</article>

		<article class="flex flex-col gap-8">
			<header class="flex w-full flex-row justify-between gap-2">
				<h3 class="text-lg text-neutral-100">
					Destacados ({popularPosts.length})
				</h3>
			</header>
			{popularPosts.length === 0 && <p>A√∫n hay mucho por contar...</p>}

			<section class="flex flex-col gap-4">
				{
					popularPosts.length !== 0 &&
						popularPosts.map((popularPost) => <ProjectCard post={popularPost} />)
				}
			</section>
		</article>

		<div>
			<p class="text-lg text-neutral-200 md:text-xl">
				¬øTe gust√≥ lo que le√≠ste o te result√≥ √∫til lo que encontaste?
			</p>
			<LikeButton className="mt-3" />
		</div>

		<article class="flex flex-col gap-8">
			<header class="flex w-full flex-row justify-between gap-2">
				<h3 class="text-lg text-neutral-100">Contacto</h3>
			</header>
			<p>
				Email me at <Link
					href={`mailto:${presentation.mail}`}
					label={presentation.mail}
				/> or follow me via my social links.
			</p>

			<SocialLinks />
		</article>
	</main>
</Layout>
